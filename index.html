
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepfos | API Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
        .gradient-brand { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
    </style>
    <!-- 运行时依赖：直接从 CDN 加载，打开本文件即可预览 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useMemo, useEffect, useRef } = React;

      // 基础数据与图标
      const KeyStatus = {
        ACTIVE: 'ACTIVE',
        REVOKED: 'REVOKED',
        EXPIRED: 'EXPIRED',
      };

      const INITIAL_SPACES = [
        { id: 'sp-1', name: '产品培训' },
        { id: 'sp-2', name: '北区金融事业部' },
        { id: 'sp-3', name: 'Etrust' },
        { id: 'sp-4', name: 'supermonkey' },
        { id: 'sp-5', name: '宝胜集团' },
        { id: 'sp-6', name: '对账' },
        { id: 'sp-7', name: '产研__Deep+功能介绍' },
        { id: 'sp-8', name: '南区地产培训' },
      ];

      const INITIAL_APPS = [
        { id: 'app-1', spaceId: 'sp-7', name: '元数据管理系统' },
        { id: 'app-2', spaceId: 'sp-7', name: '业务数据服务' },
        { id: 'app-3', spaceId: 'sp-7', name: 'DeepEngine Core' },
      ];

      const ICONS = {
        Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
        ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
        More: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>,
        Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
        Copy: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
        Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
        Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>,
        User: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
        Box: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/></svg>,
        Info: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
      };

      const maskKeyStr = (str) => {
        if (str.length <= 10) return str;
        return `${str.slice(0, 6)}****${str.slice(-4)}`;
      };

      // 组件：表格
      const ApiKeyTable = ({ keys, apps, onRevoke, onEdit }) => {
        const getValidityInfo = (key) => {
          const now = new Date();
          const expiry = key.expiresAt ? new Date(key.expiresAt) : null;
          const isExpired = expiry && expiry < now;

          if (isExpired) {
            return {
              row1: (
                <div className="flex items-center gap-1.5">
                  <div className="w-1.5 h-1.5 rounded-full bg-rose-500"></div>
                  <span className="text-rose-600 font-bold">已过期</span>
                </div>
              ),
              row2: <span className="text-slate-400 font-mono text-[10px]">{key.expiresAt?.replace('T', ' ').split('.')[0]}</span>,
              canEdit: false,
            };
          }

          if (expiry) {
            const diffDays = Math.ceil((expiry.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));
            return {
              row1: (
                <div className="flex items-center gap-1.5">
                  <div className="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                  <span className="text-emerald-700 font-bold">生效中</span>
                  <span className="text-slate-500 font-medium">({diffDays}天后到期)</span>
                </div>
              ),
              row2: <span className="text-slate-400 font-mono text-[10px]">{key.expiresAt?.replace('T', ' ').split('.')[0]}</span>,
              canEdit: true,
            };
          }

          return {
            row1: (
              <div className="flex items-center gap-1.5">
                <div className="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                <span className="text-emerald-700 font-bold">生效中</span>
              </div>
            ),
            row2: <span className="text-slate-400 font-medium text-[10px]">永久有效</span>,
            canEdit: true,
          };
        };

        const formatRelativeTime = (dateStr) => {
          if (!dateStr) return '未使用';
          const date = new Date(dateStr);
          const now = new Date();
          const diffMs = now.getTime() - date.getTime();
          const diffSec = Math.floor(diffMs / 1000);
          const diffMin = Math.floor(diffSec / 60);
          const diffHour = Math.floor(diffMin / 60);
          const diffDay = Math.floor(diffHour / 24);
          const diffMonth = Math.floor(diffDay / 30);

          if (diffMonth > 0) return `${diffMonth}个月前`;
          if (diffDay > 0) return `${diffDay}天前`;
          if (diffHour > 0) return `${diffHour}小时前`;
          if (diffMin > 0) return `${diffMin}分钟前`;
          return '刚刚';
        };

        const getAuthorizedAppNames = (ids) => {
          if (ids.length === 0) return '全部应用';
          const names = ids.map(id => apps.find(a => a.id === id)?.name).filter(Boolean);
          if (names.length <= 3) return names.join('、');
          return `${names.slice(0, 3).join('、')} 等 ${ids.length} 个应用`;
        };

        return (
          <div className="overflow-hidden bg-white rounded-xl border border-slate-200 shadow-sm overflow-x-auto">
            <table className="w-full text-left text-sm min-w-[1200px]">
              <thead className="bg-slate-50 border-b border-slate-200 text-slate-400 font-bold">
                <tr>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider min-w-[200px]">名称 / 密钥掩码</th>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider">状态 / 期限</th>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider">接口执行用户</th>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider">授权范围</th>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider">最后使用时间</th>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider">创建信息</th>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider">修改信息</th>
                  <th className="px-6 py-4 text-[11px] uppercase tracking-wider text-right">操作</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-100">
                {keys.map((key) => {
                  const info = getValidityInfo(key);
                  return (
                    <tr key={key.id} className="hover:bg-slate-50/80 transition-colors group">
                      <td className="px-6 py-4">
                        <div className="flex flex-col">
                          <span className="font-bold text-slate-700">{key.name}</span>
                          <code className="text-[11px] font-mono text-slate-400 mt-1">{maskKeyStr(key.prefix)}</code>
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="flex flex-col">
                          <div className="text-xs">{info.row1}</div>
                          <div className="mt-1.5">{info.row2}</div>
                        </div>
                      </td>
                      <td className="px-6 py-4 text-slate-600">
                        <div className="flex items-center gap-2">
                          <div className="w-6 h-6 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center text-[10px] font-bold border border-indigo-100">
                            {key.userName[0]}
                          </div>
                          <span className="text-xs font-medium">{key.userName}</span>
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <span className={`text-[11px] px-2 py-1 rounded font-medium ${key.authorizedAppIds.length === 0 ? 'bg-slate-100 text-slate-500' : 'bg-blue-50 text-blue-600'}`}>
                          {getAuthorizedAppNames(key.authorizedAppIds)}
                        </span>
                      </td>
                      <td className="px-6 py-4">
                        <div className="flex flex-col">
                          <span className="text-xs text-slate-600 font-medium">
                            {formatRelativeTime(key.lastUsedAt)}
                          </span>
                          {key.lastUsedAt && (
                            <span className="text-[10px] text-slate-400 mt-1.5 font-mono">
                              {key.lastUsedAt.replace('T', ' ').split('.')[0]}
                            </span>
                          )}
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="flex flex-col">
                          <span className="text-xs text-slate-600 font-medium">{key.creatorName}</span>
                          <span className="text-[10px] text-slate-400 mt-0.5 font-mono">{key.createdAt}</span>
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="flex flex-col">
                          <span className="text-xs text-slate-600 font-medium">{key.updaterName || '--'}</span>
                          <span className="text-[10px] text-slate-400 mt-0.5 font-mono">{key.updatedAt || '--'}</span>
                        </div>
                      </td>
                      <td className="px-6 py-4 text-right">
                        <div className="flex items-center justify-end gap-1">
                          {key.status === KeyStatus.ACTIVE && info.canEdit && (
                            <>
                              <button onClick={() => onEdit(key)} className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all" title="编辑密钥">
                                <ICONS.Edit />
                              </button>
                              <button onClick={() => onRevoke(key.id)} className="p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg opacity-0 group-hover:opacity-100 transition-all" title="立即禁用">
                                <ICONS.Trash />
                              </button>
                            </>
                          )}
                        </div>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        );
      };

      // 组件：创建弹窗
      const CreateKeyModal = ({ onClose, onCreate, spaceName, spaceId, apps }) => {
        const [name, setName] = useState('');
        const [userId, setUserId] = useState('user-current');
        const [authType, setAuthType] = useState('all');
        const [selectedApps, setSelectedApps] = useState([]);
        const [expireType, setExpireType] = useState('permanent');
        const [expireDate, setExpireDate] = useState(new Date().toISOString().split('T')[0]);

        const remainingDays = useMemo(() => {
          if (expireType === 'permanent' || !expireDate) return null;
          const diff = new Date(expireDate).getTime() - new Date().setHours(0,0,0,0);
          const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
          return days;
        }, [expireType, expireDate]);

        const setShortcut = (days) => {
          const target = new Date();
          target.setDate(target.getDate() + days);
          setExpireDate(target.toISOString().split('T')[0]);
        };

        const handleSubmit = (e) => {
          e.preventDefault();
          onCreate({
            name,
            userId,
            userName: userId === 'user-current' ? '文俊' : '系统管理员',
            authorizedAppIds: authType === 'all' ? [] : selectedApps,
            expiresAt: expireType === 'specified' && expireDate ? new Date(`${expireDate}T23:59:59`).toISOString() : undefined,
            status: KeyStatus.ACTIVE,
            spaceId,
            prefix: 'dp_' + Math.random().toString(36).substring(2, 8)
          });
        };

        return (
          <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm">
            <div className="w-full max-w-lg bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200">
              <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                <h3 className="text-lg font-black text-slate-800 tracking-tight">创建空间访问密钥</h3>
                <button onClick={onClose} className="text-slate-400 hover:text-slate-600 transition-colors">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
                </button>
              </div>

              <form onSubmit={handleSubmit} className="p-8 space-y-6">

                <div className="space-y-2">
                  <label className="text-xs font-black text-slate-400 uppercase tracking-wider">密钥标识名称</label>
                  <input required type="text" value={name} onChange={e => setName(e.target.value)} className="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm outline-none focus:ring-4 focus:ring-indigo-50 focus:border-indigo-200 transition-all" placeholder="如：自动化数据同步" />
                </div>
                <div className="space-y-2">
                    <label className="text-xs font-black text-slate-400 uppercase tracking-wider">接口执行用户</label>
                    <div className="px-4 py-2 bg-slate-50 border border-slate-100 rounded-xl text-slate-400 text-xs font-bold">{'文俊'}</div>
                </div>

                <div className="space-y-2">
                  <label className="text-xs font-black text-slate-400 uppercase tracking-wider">授权应用范围</label>
                  <div className="flex gap-4 p-1 bg-slate-50 rounded-xl w-fit">
                    <button type="button" onClick={() => setAuthType('all')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${authType === 'all' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>全部应用</button>
                    <button type="button" onClick={() => setAuthType('custom')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${authType === 'custom' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>指定应用</button>
                  </div>
                  {authType === 'custom' && (
                    <div className="grid grid-cols-2 gap-2 max-h-32 overflow-y-auto p-4 bg-slate-50 rounded-xl border border-slate-100 custom-scrollbar mt-2">
                      {apps.map(app => (
                        <label key={app.id} className="flex items-center gap-2 text-xs cursor-pointer hover:text-indigo-600 transition-colors">
                          <input type="checkbox" className="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" onChange={(e) => {
                            if (e.target.checked) setSelectedApps([...selectedApps, app.id]);
                            else setSelectedApps(selectedApps.filter(id => id !== app.id));
                          }} /> {app.name}
                        </label>
                      ))}
                    </div>
                  )}
                </div>

                <div className="space-y-3">
                  <label className="text-xs font-black text-slate-400 uppercase tracking-wider">授权有效期</label>
                  <div className="flex gap-4 p-1 bg-slate-50 rounded-xl w-fit">
                    <button type="button" onClick={() => setExpireType('permanent')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${expireType === 'permanent' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>永久有效</button>
                    <button type="button" onClick={() => setExpireType('specified')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${expireType === 'specified' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>指定期限</button>
                  </div>

                  {expireType === 'specified' && (
                    <div className="space-y-3 p-4 bg-slate-50 rounded-xl border border-slate-100 animate-in fade-in slide-in-from-top-2 duration-200">
                      <div className="flex justify-between items-center">
                        <div className="flex items-center gap-1 group relative">
                          <span className="text-[10px] font-black text-slate-400 uppercase tracking-wider">有效至</span>
                          <div className="text-slate-300 hover:text-slate-400 cursor-help transition-colors">
                            <ICONS.Info />
                          </div>
                          <div className="absolute left-0 bottom-full mb-2 hidden group-hover:block w-48 p-2 bg-slate-800 text-white text-[10px] rounded-lg shadow-xl z-20 pointer-events-none">
                            api-key有效至该日期23:59:59
                            <div className="absolute left-4 top-full w-0 h-0 border-l-[4px] border-l-transparent border-r-[4px] border-r-transparent border-t-[4px] border-t-slate-800"></div>
                          </div>
                        </div>
                        {remainingDays !== null && (
                          <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${
                            remainingDays > 0 ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'
                          }`}>
                            {remainingDays > 0 
                              ? `预计还有 ${remainingDays} 天失效` 
                              : `已过期 ${Math.abs(remainingDays)} 天`
                            }
                          </span>
                        )}
                      </div>
                      
                      <input 
                        type="date" 
                        value={expireDate} 
                        min={new Date().toISOString().split('T')[0]}
                        onChange={e => setExpireDate(e.target.value)}
                        className="w-full px-4 py-2 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-indigo-50 transition-all text-slate-700 bg-white"
                      />

                      <div className="flex gap-2">
                        {[30, 90, 180, 365].map(days => (
                          <button 
                            key={days}
                            type="button" 
                            onClick={() => setShortcut(days)}
                            className="flex-1 py-1.5 text-[10px] font-bold text-slate-500 border border-slate-200 bg-white rounded-lg hover:border-indigo-200 hover:text-indigo-600 hover:bg-indigo-50/30 transition-all"
                          >
                            +{days}天
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="pt-4 flex gap-4">
                  <button type="button" onClick={onClose} className="flex-1 py-3 text-sm font-bold text-slate-500 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors">取消</button>
                  <button type="submit" className="flex-1 py-3 text-sm font-bold text-white bg-indigo-600 rounded-xl hover:bg-indigo-700 shadow-xl shadow-indigo-100 transition-all active:scale-95">确认生成密钥</button>
                </div>
              </form>
            </div>
          </div>
        );
      };

      // 组件：编辑弹窗
      const EditKeyModal = ({ apiKey, onClose, onUpdate, apps }) => {
        const [name, setName] = useState(apiKey.name);
        const [authType, setAuthType] = useState(apiKey.authorizedAppIds.length === 0 ? 'all' : 'custom');
        const [selectedApps, setSelectedApps] = useState(apiKey.authorizedAppIds);
        const [expireType, setExpireType] = useState(apiKey.expiresAt ? 'specified' : 'permanent');
        const [expireDate, setExpireDate] = useState(apiKey.expiresAt ? apiKey.expiresAt.split('T')[0] : new Date().toISOString().split('T')[0]);

        const remainingDays = useMemo(() => {
          if (expireType === 'permanent' || !expireDate) return null;
          const diff = new Date(expireDate).getTime() - new Date().setHours(0,0,0,0);
          const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
          return days;
        }, [expireType, expireDate]);

        const setShortcut = (days) => {
          const target = new Date();
          target.setDate(target.getDate() + days);
          setExpireDate(target.toISOString().split('T')[0]);
        };

        const handleSubmit = (e) => {
          e.preventDefault();
          onUpdate({
            name,
            authorizedAppIds: authType === 'all' ? [] : selectedApps,
            expiresAt: expireType === 'specified' && expireDate ? new Date(`${expireDate}T23:59:59`).toISOString() : undefined,
          });
        };

        return (
          <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm">
            <div className="w-full max-w-lg bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200">
              <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                <h3 className="text-lg font-black text-slate-800 tracking-tight">编辑密钥配置</h3>
                <button onClick={onClose} className="text-slate-400 hover:text-slate-600 transition-colors">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
                </button>
              </div>

              <form onSubmit={handleSubmit} className="p-8 space-y-6">

                <div className="space-y-2">
                  <label className="text-xs font-black text-slate-400 uppercase tracking-wider">密钥标识名称</label>
                  <input required type="text" value={name} onChange={e => setName(e.target.value)} className="w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm outline-none focus:ring-4 focus:ring-indigo-50 focus:border-indigo-200 transition-all" />
                </div>

                <div className="space-y-2">
                    <label className="text-xs font-black text-slate-400 uppercase tracking-wider">接口执行用户</label>
                    <div className="px-4 py-2 bg-slate-50 border border-slate-100 rounded-xl text-slate-400 text-xs font-bold">{apiKey.userName}</div>
                </div>
                

                <div className="space-y-3">
                  <label className="text-xs font-black text-slate-400 uppercase tracking-wider">授权应用范围</label>
                  <div className="flex gap-4 p-1 bg-slate-50 rounded-xl w-fit">
                    <button type="button" onClick={() => setAuthType('all')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${authType === 'all' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>全部应用</button>
                    <button type="button" onClick={() => setAuthType('custom')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${authType === 'custom' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>指定应用</button>
                  </div>
                  {authType === 'custom' && (
                    <div className="grid grid-cols-2 gap-2 max-h-32 overflow-y-auto p-4 bg-slate-50 rounded-xl border border-slate-100 mt-2 custom-scrollbar">
                      {apps.map(app => (
                        <label key={app.id} className="flex items-center gap-2 text-xs cursor-pointer hover:text-indigo-600 transition-colors">
                          <input type="checkbox" checked={selectedApps.includes(app.id)} className="rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" onChange={(e) => {
                            if (e.target.checked) setSelectedApps([...selectedApps, app.id]);
                            else setSelectedApps(selectedApps.filter(id => id !== app.id));
                          }} /> {app.name}
                        </label>
                      ))}
                    </div>
                  )}
                </div>

                <div className="space-y-3">
                  <label className="text-xs font-black text-slate-400 uppercase tracking-wider">授权有效期</label>
                  <div className="flex gap-4 p-1 bg-slate-50 rounded-xl w-fit">
                    <button type="button" onClick={() => setExpireType('permanent')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${expireType === 'permanent' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>永久有效</button>
                    <button type="button" onClick={() => setExpireType('specified')} className={`px-4 py-1.5 text-xs font-bold rounded-lg transition-all ${expireType === 'specified' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>指定期限</button>
                  </div>

                  {expireType === 'specified' && (
                    <div className="space-y-3 p-4 bg-slate-50 rounded-xl border border-slate-100 animate-in fade-in slide-in-from-top-2 duration-200">
                      <div className="flex justify-between items-center">
                        <div className="flex items-center gap-1 group relative">
                          <span className="text-[10px] font-black text-slate-400 uppercase tracking-wider">有效至</span>
                          <div className="text-slate-300 hover:text-slate-400 cursor-help transition-colors">
                            <ICONS.Info />
                          </div>
                          <div className="absolute left-0 bottom-full mb-2 hidden group-hover:block w-48 p-2 bg-slate-800 text-white text-[10px] rounded-lg shadow-xl z-20 pointer-events-none">
                            api-key有效至该日期23:59:59
                            <div className="absolute left-4 top-full w-0 h-0 border-l-[4px] border-l-transparent border-r-[4px] border-r-transparent border-t-[4px] border-t-slate-800"></div>
                          </div>
                        </div>
                        {remainingDays !== null && (
                          <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${remainingDays > 0 ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'}`}>
                            {remainingDays > 0 ? `预计还有 ${remainingDays} 天失效` : '已过期'}
                          </span>
                        )}
                      </div>
                      
                      <input 
                        type="date" 
                        value={expireDate} 
                        min={new Date().toISOString().split('T')[0]}
                        onChange={e => setExpireDate(e.target.value)}
                        className="w-full px-4 py-2 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-indigo-50 transition-all text-slate-700 bg-white"
                      />

                      <div className="flex gap-2">
                        {[30, 90, 180, 365].map(days => (
                          <button 
                            key={days}
                            type="button" 
                            onClick={() => setShortcut(days)}
                            className="flex-1 py-1.5 text-[10px] font-bold text-slate-500 border border-slate-200 bg-white rounded-lg hover:border-indigo-200 hover:text-indigo-600 hover:bg-indigo-50/30 transition-all"
                          >
                            +{days}天
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="pt-4 flex gap-4">
                  <button type="button" onClick={onClose} className="flex-1 py-3 text-sm font-bold text-slate-500 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors">取消</button>
                  <button type="submit" className="flex-1 py-3 text-sm font-bold text-white bg-indigo-600 rounded-xl hover:bg-indigo-700 shadow-xl shadow-indigo-100 transition-all active:scale-95">保存修改</button>
                </div>
              </form>
            </div>
          </div>
        );
      };

      // 组件：展示密钥
      const RevealKeyModal = ({ apiKey, onClose }) => {
        const handleCopy = () => {
          navigator.clipboard.writeText(apiKey);
          alert("密钥已复制到剪贴板");
        };

        return (
          <div className="fixed inset-0 z-[110] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md">
            <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200">
              <div className="p-8 text-center space-y-6">
                <div className="w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                </div>
                
                <div className="space-y-2">
                  <h3 className="text-xl font-bold text-slate-900">API 密钥已成功生成</h3>
                  <p className="text-sm text-slate-500 px-4">
                    为了您的安全，该密钥<span className="text-rose-600 font-bold">只会显示这一次</span>。请立即复制并妥善保存。
                  </p>
                </div>

                <div className="relative group">
                  <div className="p-4 bg-slate-50 border-2 border-dashed border-indigo-200 rounded-xl font-mono text-lg text-indigo-700 break-all select-all">
                    {apiKey}
                  </div>
                  <button 
                    onClick={handleCopy}
                    className="absolute right-2 top-2 p-2 bg-white shadow-sm border border-slate-200 rounded-lg text-slate-500 hover:text-indigo-600 transition-colors"
                  >
                    <ICONS.Copy />
                  </button>
                </div>

                <div className="flex flex-col gap-3 pt-4">
                  <button 
                    onClick={handleCopy}
                    className="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-all active:scale-95"
                  >
                    一键复制并关闭
                  </button>
                  <button 
                    onClick={onClose}
                    className="w-full py-3 text-slate-500 text-sm font-medium hover:text-slate-800"
                  >
                    我已保存，关闭窗口
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // 主应用
      const App = () => {
        const [spaces] = useState(INITIAL_SPACES);
        const [apps] = useState(INITIAL_APPS);
        const [activeSpaceId, setActiveSpaceId] = useState('sp-7');
        const [activeTab, setActiveTab] = useState('api');
        const [searchSpace, setSearchSpace] = useState('');
        const [filterText, setFilterText] = useState('');
        const [isFilterOpen, setIsFilterOpen] = useState(false);
        const filterRef = useRef(null);
        const [selAppIds, setSelAppIds] = useState([]);
        const [expiryFilter, setExpiryFilter] = useState('all');
        const [viewMyOnly, setViewMyOnly] = useState(false);
        const [isAppDropdownOpen, setIsAppDropdownOpen] = useState(false);

        const [keys, setKeys] = useState([
          {
            id: 'k-1',
            name: '元数据同步服务 (主)',
            prefix: 'dp_a7f298k1l0m9',
            status: KeyStatus.ACTIVE,
            userId: 'user-current',
            userName: '文俊',
            creatorId: 'user-current',
            creatorName: '文俊',
            createdAt: '2024-05-01 10:20:00',
            updaterId: 'user-current',
            updaterName: '文俊',
            updatedAt: '2024-05-01 10:20:00',
            lastUsedAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
            authorizedAppIds: ['app-1', 'app-2'],
            scopes: [],
            appId: 'app-1',
            spaceId: 'sp-7',
            usageCount: 120,
            expiresAt: '2025-12-28T23:59:59'
          },
          {
            id: 'k-2',
            name: '测试环境全域Key',
            prefix: 'dp_global_test_v2',
            status: KeyStatus.ACTIVE,
            userId: 'user-current',
            userName: '文俊',
            creatorId: 'user-current',
            creatorName: '文俊',
            createdAt: '2024-01-15 09:00:00',
            lastUsedAt: new Date(Date.now() - 15 * 60 * 1000).toISOString(),
            authorizedAppIds: [], 
            scopes: [],
            appId: 'app-1',
            spaceId: 'sp-7',
            usageCount: 2540,
            expiresAt: undefined 
          },
          {
            id: 'k-3',
            name: '归档数据提取工具',
            prefix: 'dp_archived_legacy',
            status: KeyStatus.ACTIVE,
            userId: 'user-current',
            userName: '文俊',
            creatorId: 'user-current',
            creatorName: '文俊',
            createdAt: '2023-11-10 14:30:00',
            lastUsedAt: '2024-01-20 11:22:33',
            authorizedAppIds: ['app-3'],
            scopes: [],
            appId: 'app-3',
            spaceId: 'sp-7',
            usageCount: 42,
            expiresAt: '2024-01-01T23:59:59'
          },
          {
            id: 'k-4',
            name: '系统管理员备用Key (Root)',
            prefix: 'dp_root_admin_sys',
            status: KeyStatus.ACTIVE,
            userId: 'user-admin',
            userName: '管理员',
            creatorId: 'user-admin',
            creatorName: '管理员',
            createdAt: '2024-03-01 16:45:10',
            lastUsedAt: undefined,
            authorizedAppIds: [],
            scopes: [],
            appId: 'app-1',
            spaceId: 'sp-7',
            usageCount: 0,
            expiresAt: '2026-03-18T23:59:59'
          },
          {
            id: 'k-6',
            name: '即将到期的预警Key',
            prefix: 'dp_warning_exp_01',
            status: KeyStatus.ACTIVE,
            userId: 'user-current',
            userName: '文俊',
            creatorId: 'user-current',
            creatorName: '文俊',
            createdAt: '2024-04-20 12:00:00',
            lastUsedAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
            authorizedAppIds: ['app-1', 'app-2', 'app-3'],
            scopes: [],
            appId: 'app-1',
            spaceId: 'sp-7',
            usageCount: 432,
            expiresAt: '2025-12-25T23:59:59'
          }
        ]);

        const [isModalOpen, setIsModalOpen] = useState(false);
        const [editingKey, setEditingKey] = useState(null);
        const [revealingKey, setRevealingKey] = useState(null);
        const [toast, setToast] = useState(null);

        const activeSpace = useMemo(() => spaces.find(s => s.id === activeSpaceId), [activeSpaceId, spaces]);
        const filteredSpaces = useMemo(() => spaces.filter(s => s.name.toLowerCase().includes(searchSpace.toLowerCase())), [searchSpace, spaces]);
        const spaceApps = useMemo(() => apps.filter(a => a.spaceId === activeSpaceId), [activeSpaceId, apps]);

        useEffect(() => {
          const handleClickOutside = (event) => {
            if (filterRef.current && !filterRef.current.contains(event.target)) {
              setIsFilterOpen(false);
            }
          };
          document.addEventListener('mousedown', handleClickOutside);
          return () => document.removeEventListener('mousedown', handleClickOutside);
        }, []);

        const currentSpaceKeys = useMemo(() => {
          return keys
            .filter(k => k.spaceId === activeSpaceId)
            .filter(k => {
              if (filterText && !k.name.toLowerCase().includes(filterText.toLowerCase())) return false;
              if (selAppIds.length > 0) {
                const isGlobal = k.authorizedAppIds.length === 0;
                const hasMatch = k.authorizedAppIds.some(id => selAppIds.includes(id));
                if (!isGlobal && !hasMatch) return false;
              }
              if (viewMyOnly && k.creatorId !== 'user-current') return false;
              if (expiryFilter !== 'all') {
                const now = new Date();
                const expiry = k.expiresAt ? new Date(k.expiresAt) : null;
                if (expiryFilter === 'permanent' && expiry) return false;
                if (expiryFilter === 'expired') {
                  if (!expiry || expiry > now) return false;
                }
                if (expiryFilter === '7d') {
                  if (!expiry || expiry < now || expiry > new Date(now.getTime() + 7*24*60*60*1000)) return false;
                }
                if (expiryFilter === '30d') {
                  if (!expiry || expiry < now || expiry > new Date(now.getTime() + 30*24*60*60*1000)) return false;
                }
              }
              return true;
            });
        }, [activeSpaceId, keys, filterText, selAppIds, expiryFilter, viewMyOnly]);

        const resetFilters = () => {
          setSelAppIds([]);
          setExpiryFilter('all');
          setViewMyOnly(false);
        };

        const tabs = [
          { id: 'overview', label: '概览' },
          { id: 'app', label: '应用管理' },
          { id: 'component', label: '组件管理' },
          { id: 'member', label: '空间成员' },
          { id: 'api', label: 'API密钥' },
          { id: 'datasource', label: '内置数据源' },
        ];

        const formatDate = (date) => {
          const pad = (n) => n.toString().padStart(2, '0');
          return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
        };

        const handleCreateKey = (newKeyData) => {
          const generateRandomStr = (len) => {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let res = '';
            for(let i=0; i<len; i++) res += chars.charAt(Math.floor(Math.random() * chars.length));
            return res;
          };

          const now = formatDate(new Date());
          const suffix = generateRandomStr(32);
          const longerPrefix = `${newKeyData.prefix}${generateRandomStr(8)}`;
          const fullKey = `${longerPrefix}_${suffix}`;

          const newKey = {
            ...newKeyData,
            prefix: longerPrefix,
            id: `k-${Date.now()}`,
            creatorId: 'user-current',
            creatorName: '文俊',
            createdAt: now,
            updaterId: 'user-current',
            updaterName: '文俊',
            updatedAt: now,
            usageCount: 0,
            fullKey
          };
          
          setKeys([newKey, ...keys]);
          setIsModalOpen(false);
          setRevealingKey(fullKey);
        };

        const handleUpdateKey = (data) => {
          if (!editingKey) return;
          const now = formatDate(new Date());
          setKeys(keys.map(k => k.id === editingKey.id ? {
            ...k,
            ...data,
            updaterId: 'user-current',
            updaterName: '文俊',
            updatedAt: now
          } : k));
          setEditingKey(null);
          showToast("密钥配置已更新");
        };

        const handleRevokeKey = (id) => {
          if (confirm("确定要禁用该 API 密钥 吗？此操作不可逆。")) {
            const now = formatDate(new Date());
            setKeys(keys.map(k => k.id === id ? { 
              ...k, 
              status: KeyStatus.REVOKED,
              updaterId: 'user-current',
              updaterName: '文俊',
              updatedAt: now
            } : k));
            showToast("密钥已失效");
          }
        };

        const showToast = (msg) => {
          setToast(msg);
          setTimeout(() => setToast(null), 3000);
        };

        return (
          <div className="flex flex-col h-screen bg-slate-50 overflow-hidden text-slate-900">
            <header className="h-12 bg-[#5d6be5] flex items-center justify-between px-6 shrink-0 shadow-lg z-10">
              <div className="flex items-center gap-8">
                <div className="font-black text-white text-lg tracking-wider flex items-center gap-2">
                  <div className="w-6 h-6 bg-white rounded text-[#5d6be5] flex items-center justify-center text-xs font-bold">D</div>
                  DEEPFOS
                </div>
                <nav className="flex gap-6 h-full">
                  {['工作台', '配置管理', '应用市场'].map(item => (
                    <button key={item} className={`text-sm font-bold flex items-center h-full px-2 transition-all ${item === '配置管理' ? 'text-white border-b-4 border-white' : 'text-indigo-100 hover:text-white'}`}>
                      {item}
                    </button>
                  ))}
                </nav>
              </div>
              <div className="flex items-center gap-4 text-white">
                <div className="flex items-center gap-2 bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-full text-xs font-bold transition-colors cursor-pointer border border-white/10">
                  <span className="w-2 h-2 bg-emerald-400 rounded-full"></span>
                  先胜业财
                  <ICONS.ChevronRight />
                </div>
                <div className="flex items-center gap-2 group cursor-pointer">
                  <div className="w-8 h-8 bg-indigo-400 rounded-full border-2 border-white/40 flex items-center justify-center font-bold text-xs shadow-inner transition-transform group-hover:scale-105">文</div>
                  <span className="text-xs font-bold hidden md:block">文俊</span>
                </div>
              </div>
            </header>

            <div className="flex flex-1 overflow-hidden">
              <aside className="w-[260px] bg-white border-r border-slate-200 flex flex-col shrink-0">
                <div className="p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[2px]">空间导航</h3>
                    <button className="p-1.5 hover:bg-slate-100 rounded text-slate-400"><ICONS.Search /></button>
                  </div>
                  <div className="relative mb-6">
                    <input 
                      type="text" 
                      placeholder="搜索空间..." 
                      value={searchSpace}
                      onChange={e => setSearchSpace(e.target.value)}
                      className="w-full pl-9 pr-3 py-2 bg-slate-100 border-none rounded-xl text-xs outline-none focus:ring-2 focus:ring-indigo-200"
                    />
                    <div className="absolute left-3 top-2.5 text-slate-400"><ICONS.Search /></div>
                  </div>
                  <div className="space-y-1 max-h-[calc(100vh-280px)] overflow-y-auto pr-2 custom-scrollbar">
                    {filteredSpaces.map(s => (
                      <button 
                        key={s.id}
                        onClick={() => setActiveSpaceId(s.id)}
                        className={`w-full text-left px-4 py-3 rounded-xl text-xs font-bold transition-all flex items-center gap-3 group ${
                          activeSpaceId === s.id ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-800'
                        }`}
                      >
                        <div className={`w-1.5 h-1.5 rounded-full ${activeSpaceId === s.id ? 'bg-white' : 'bg-slate-300'}`}></div>
                        <span className="truncate">{s.name}</span>
                      </button>
                    ))}
                  </div>
                </div>
              </aside>

              <main className="flex-1 overflow-y-auto flex flex-col">
                <div className="bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm">
                  <div className="px-10 pt-8 pb-0">
                    <div className="flex items-center gap-4 mb-6">
                      <div className="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-indigo-100">
                        <ICONS.Box />
                      </div>
                      <div>
                        <h2 className="text-2xl font-black text-slate-900 tracking-tight">{activeSpace?.name}</h2>
                        <div className="flex items-center gap-2 text-[10px] text-slate-400 font-bold mt-1">
                          <span>Deepfos 平台</span>
                          <span className="w-1 h-1 bg-slate-200 rounded-full"></span>
                          <span>空间 ID: {activeSpaceId}</span>
                        </div>
                      </div>
                    </div>
                    
                    <div className="flex gap-2">
                      {tabs.map(tab => (
                        <button
                          key={tab.id}
                          onClick={() => setActiveTab(tab.id)}
                          className={`px-5 py-3 text-xs font-bold transition-all relative ${
                            activeTab === tab.id ? 'text-indigo-600' : 'text-slate-400 hover:text-slate-700'
                          }`}
                        >
                          {tab.label}
                          {activeTab === tab.id && <div className="absolute bottom-0 left-0 right-0 h-1 bg-indigo-600 rounded-t-full"></div>}
                        </button>
                      ))}
                    </div>
                  </div>
                </div>

                <div className="p-10 max-w-full mx-auto w-full space-y-6">
                  {activeTab === 'api' ? (
                    <>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          <button 
                            onClick={() => setIsModalOpen(true)}
                            className="flex items-center h-10 px-6 bg-indigo-600 text-white text-sm font-bold rounded-lg hover:bg-indigo-700 transition-all shadow-md shadow-indigo-100 active:scale-95"
                          >
                            新建密钥
                          </button>
                        </div>

                        <div className="flex items-center gap-3">
                          <div 
                            className="flex items-center gap-2 px-1 group cursor-pointer select-none" 
                            onClick={() => setViewMyOnly(!viewMyOnly)}
                          >
                            <div className={`w-7 h-4 rounded-full relative transition-colors duration-200 ${viewMyOnly ? 'bg-indigo-600' : 'bg-slate-200'}`}>
                              <div 
                                className={`absolute top-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-all duration-200 ${viewMyOnly ? 'left-3.5' : 'left-0.5'}`}
                              ></div>
                            </div>
                            <span className={`text-xs font-bold transition-colors ${viewMyOnly ? 'text-indigo-600' : 'text-slate-400 group-hover:text-slate-600'}`}>查看我的</span>
                          </div>

                          <div className="relative group flex items-center">
                            <input 
                              type="text" 
                              placeholder="搜索密钥名称或掩码" 
                              value={filterText} 
                              onChange={e => setFilterText(e.target.value)} 
                              className="w-[280px] h-10 pl-4 pr-10 bg-white border border-slate-200 border-r-0 rounded-l-lg text-sm outline-none focus:border-indigo-600 transition-all placeholder:text-slate-400" 
                            />
                            <button className="h-10 px-3 bg-white border border-slate-200 border-l-0 rounded-r-lg text-slate-400 hover:text-indigo-600 transition-colors">
                              <ICONS.Search />
                            </button>
                          </div>

                          <div className="relative" ref={filterRef}>
                            <button 
                              onClick={() => setIsFilterOpen(!isFilterOpen)}
                              className={`flex items-center h-10 px-4 gap-2 bg-white border ${isFilterOpen ? 'border-indigo-600 text-indigo-600' : 'border-slate-200 text-slate-600'} rounded-lg text-sm font-medium hover:border-slate-300 transition-all`}
                            >
                              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
                              筛选
                              {(selAppIds.length > 0 || expiryFilter !== 'all') && (
                                <span className="w-1.5 h-1.5 bg-indigo-600 rounded-full"></span>
                              )}
                            </button>
                            
                            {isFilterOpen && (
                              <div className="absolute right-0 mt-2 w-72 bg-white border border-slate-200 rounded-2xl shadow-2xl z-40 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200">
                                <div className="px-4 py-3 border-b border-slate-50 flex justify-between items-center bg-slate-50/50">
                                  <span className="text-xs font-black text-slate-400 uppercase tracking-widest">高级筛选</span>
                                  <button onClick={resetFilters} className="text-[10px] font-bold text-indigo-600 hover:text-indigo-700">重置</button>
                                </div>
                                
                                <div className="p-4 space-y-5">
                                  <div className="space-y-2">
                                    <span className="text-[10px] font-bold text-slate-400 uppercase">应用范围</span>
                                    <div className="relative">
                                      <button 
                                        onClick={() => setIsAppDropdownOpen(!isAppDropdownOpen)}
                                        className="w-full flex items-center justify-between px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs text-slate-600 hover:border-indigo-200 transition-all"
                                      >
                                        <span className="truncate">
                                          {selAppIds.length === 0 ? '选择应用...' : `已选 ${selAppIds.length} 个应用`}
                                        </span>
                                        <div className={`transition-transform duration-200 ${isAppDropdownOpen ? 'rotate-90' : ''}`}>
                                          <ICONS.ChevronRight />
                                        </div>
                                      </button>
                                      
                                      {isAppDropdownOpen && (
                                        <div className="absolute left-0 right-0 mt-1 bg-white border border-slate-200 rounded-xl shadow-xl z-50 py-1 max-h-48 overflow-y-auto custom-scrollbar animate-in fade-in zoom-in-95 duration-150">
                                          {spaceApps.map(app => (
                                            <label key={app.id} className="flex items-center gap-2 px-3 py-2 hover:bg-slate-50 cursor-pointer transition-colors group">
                                              <input 
                                                type="checkbox" 
                                                checked={selAppIds.includes(app.id)}
                                                onChange={(e) => {
                                                  if(e.target.checked) setSelAppIds([...selAppIds, app.id]);
                                                  else setSelAppIds(selAppIds.filter(id => id !== app.id));
                                                }}
                                                className="w-3.5 h-3.5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"
                                              />
                                              <span className={`text-xs ${selAppIds.includes(app.id) ? 'text-indigo-600 font-bold' : 'text-slate-600'}`}>{app.name}</span>
                                            </label>
                                          ))}
                                          {spaceApps.length === 0 && <div className="px-3 py-2 text-[10px] text-slate-400 italic">暂无可选应用</div>}
                                        </div>
                                      )}
                                    </div>
                                  </div>

                                  <div className="space-y-2">
                                    <span className="text-[10px] font-bold text-slate-400 uppercase">授权有效期</span>
                                    <div className="grid grid-cols-2 gap-1.5">
                                      {[
                                        { id: 'all', label: '全部' },
                                        { id: '7d', label: '7天内到期' },
                                        { id: '30d', label: '30天内到期' },
                                        { id: 'expired', label: '已过期' },
                                        { id: 'permanent', label: '永久有效' },
                                      ].map(opt => (
                                        <button 
                                          key={opt.id}
                                          onClick={() => setExpiryFilter(opt.id)}
                                          className={`px-3 py-1.5 text-left text-xs rounded-lg transition-all ${expiryFilter === opt.id ? 'bg-indigo-50 text-indigo-600 font-bold border border-indigo-100' : 'bg-slate-50 text-slate-500 border border-transparent hover:bg-slate-100'}`}
                                        >
                                          {opt.label}
                                        </button>
                                      ))}
                                    </div>
                                  </div>
                                </div>
                                
                                <div className="p-4 bg-slate-50/50 border-t border-slate-50">
                                  <button 
                                    onClick={() => setIsFilterOpen(false)}
                                    className="w-full py-2 bg-indigo-600 text-white text-xs font-bold rounded-xl hover:bg-indigo-700 shadow-lg shadow-indigo-100 transition-all"
                                  >
                                    应用筛选
                                  </button>
                                </div>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>

                      <ApiKeyTable 
                        keys={currentSpaceKeys} 
                        apps={apps}
                        onRevoke={handleRevokeKey}
                        onEdit={(key) => setEditingKey(key)}
                      />
                    </>
                  ) : (
                    <div className="flex flex-col items-center justify-center py-32 text-slate-300">
                      <div className="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-6"><ICONS.Box /></div>
                      <h3 className="text-lg font-bold text-slate-400 tracking-tight">【{tabs.find(t => t.id === activeTab)?.label}】模块建设中</h3>
                    </div>
                  )}
                </div>
              </main>
            </div>

            {isModalOpen && (
              <CreateKeyModal 
                onClose={() => setIsModalOpen(false)}
                onCreate={handleCreateKey}
                spaceName={activeSpace?.name || ''}
                spaceId={activeSpaceId}
                apps={spaceApps}
              />
            )}

            {editingKey && (
              <EditKeyModal 
                apiKey={editingKey}
                onClose={() => setEditingKey(null)}
                onUpdate={handleUpdateKey}
                apps={spaceApps}
              />
            )}

            {revealingKey && <RevealKeyModal apiKey={revealingKey} onClose={() => setRevealingKey(null)} />}
            {toast && (
              <div className="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] px-8 py-3 bg-slate-900 text-white rounded-full shadow-2xl text-xs font-bold border border-white/10 flex items-center gap-3">
                <div className="w-1.5 h-1.5 bg-emerald-400 rounded-full"></div> 
                {toast}
              </div>
            )}
          </div>
        );
      };

      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    </script>
</body>
</html>
